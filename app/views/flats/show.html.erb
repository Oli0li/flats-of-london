<%= render "shared/navbar" %>

<div class="container">
  <h1><%= @flat.name %></h1>

  <div id="flat-carousel" class="carousel slide mt-4" data-ride="carousel" data-pause="hover">
    <div class="carousel-inner">
      <% @flat.photos.each do |photo| %>
        <div class="carousel-item <%= "active" if photo == @flat.photos.first %>">
          <%= cl_image_tag photo.key, class: "flat-image-show d-block w-100" %>
        </div>
      <% end %>
    </div>
    <a class="carousel-control-prev" href="#flat-carousel" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#flat-carousel" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>

  <div class="d-flex mt-4">
    <div class="flat_details">
      <h2>About this flat</h2>
      <p>Host: <%= @flat.user.name %></p>
      <p>Capacity: <%= @flat.capacity %></p>
      <p><%= @flat.description %></p>
    </div>

    <div class="booking-form">
      <div data-controller="flatpickr" data-unavailable="<%= @flat.unavailable_dates.to_json %>" data-first-unavailable-dates="<%= @flat.booking_start_dates.to_json %>" class="widget-content">
        <p><span id="booking-form-price-per-night" data-flatpickr-target="price">Â£<%= @flat.price_per_night %></span> per night</p>
        <%= simple_form_for [@flat, @booking] do |f| %>
          <%= f.input :start_date, as: :string, label: "Dates", placeholder: "From", input_html: {class: "datepicker", "data-flatpickr-target" => "start", id: "booking_start_date" } %>
          <%= f.input :end_date, as: :hidden, label: '&nbsp;'.html_safe, placeholder: "To", disabled: true, input_html: {class: "datepicker", "data-flatpickr-target" => "end", id: "booking_end_date"} %>
          <%= f.input :number_of_guests, collection: (1..@flat.capacity) %>
          <%= f.submit "book", class: "btn btn-primary btn-lg btn-block btn-booking", data: { turbo: false } %>
          <p data-flatpickr-target="total"></p>
        <% end %>
      </div>
    </div>
  </div>


  <% if @flat.user == current_user %>
  <%= link_to "Delete this listing", flat_path(@flat), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this listing?" }, class: "btn btn-danger"%>

  <h2>Edit this flat's description</h2>
    <%= simple_form_for(@flat) do |f| %>
      <%= f.input :name %>
      <%= f.input :address %>
      <%= f.input :description %>
      <%= f.input :price_per_night %>
      <%= f.input :capacity %>
      <%= f.submit %>
    <% end %>
  <% end %>

  <%= link_to "Back to all flats", flats_path, class: "btn btn-primary mt-3" %>
</div>

<%= render "shared/footer", content_for(:color) { 'footer-purple' } %>
