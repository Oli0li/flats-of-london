<%= render "shared/navbar" %>

<div class="container">
  <h1><%= @flat.name %></h1>
  <%= cl_image_tag @flat.photo.key, class: "flat-image-show" %>
  <p>Host: <%= @flat.user.name %></p>
  <p>Capacity: <%= @flat.number_of_guests %></p>
  <p><%= @flat.description %></p>

    <%= simple_form_for [@flat, @booking] do |f| %>
     <div data-controller="flatpickr" data-unavailable="<%= @flat.unavailable_dates.to_json %>" data-lastavailable="<%= @flat.day_before_unavailable.to_json %>" class="widget-content">
      <%= f.input :start_date, as: :string, label: "Dates", placeholder: "From", input_html: {class: "datepicker", "data-flatpickr-target" => "start", id: "booking_start_date" } %>
      <%= f.input :end_date, as: :hidden, label: '&nbsp;'.html_safe, placeholder: "To", input_html: {class: "datepicker", "data-flatpickr-target" => "end", id: "booking_end_date"} %>
      </div>
      <%= f.submit "book", class: "btn btn-primary btn-lg btn-block btn-booking" %>
    <% end %>

  <% if @flat.user == current_user %>
  <%= link_to "Delete this listing", flat_path(@flat), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this listing?" }, class: "btn btn-danger"%>

  <h2>Edit this flat's description</h2>
    <%= simple_form_for(@flat) do |f| %>
      <%= f.input :name %>
      <%= f.input :address %>
      <%= f.input :description %>
      <%= f.input :price_per_night %>
      <%= f.input :number_of_guests %>
      <%= f.submit %>
    <% end %>
  <% end %>

  <%= link_to "Back to all flats", flats_path, class: "btn btn-primary mt-3" %>
</div>

<%= render "shared/footer", content_for(:color) { 'footer-purple' } %>
